
[//]: # (MC filter cell first)

```{r, include=FALSE}
# include this section if your child (nested) .Rmd has plot output. This make sure that plot is saved in correct location and displayed in rendered book. Mb not the best solution, but it works :) 
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```

```{python mc-filtering-run-first, collapse = TRUE}
total_umis_of_cells = mc.ut.get_o_numpy(ad, name='__x__', sum=True)
df_umis = pd.DataFrame(total_umis_of_cells, columns = ['total_UMIs'])

plt.figure()
sns.histplot(data=df_umis, x="total_UMIs")
plt.xlabel('UMIs')
plt.ylabel('Density')
plt.axvline(x=properly_sampled_min_cell_total, color='darkgreen')
plt.axvline(x=properly_sampled_max_cell_total, color='crimson')
plt.show()


too_small_cells_count = sum(total_umis_of_cells < properly_sampled_min_cell_total)
too_large_cells_count = sum(total_umis_of_cells > properly_sampled_max_cell_total)

too_small_cells_percent = 100.0 * too_small_cells_count / len(total_umis_of_cells)
too_large_cells_percent = 100.0 * too_large_cells_count / len(total_umis_of_cells)

print(f"Will exclude %s (%.2f%%) cells with less than %s UMIs"
      % (too_small_cells_count,
         too_small_cells_percent,
         properly_sampled_min_cell_total))
print(f"Will exclude %s (%.2f%%) cells with more than %s UMIs"
      % (too_large_cells_count,
         too_large_cells_percent,
         properly_sampled_max_cell_total))
```
