
**Size distribution**
```{python, warning = FALSE, message = FALSE}
#mc_size = SEACells.plot.plot_SEACell_sizes(ad, bins=20)

#mc_ad.obs = pd.merge(mc_ad.obs, mc_size, left_index=True, right_index=True)
#mc_ad.obs
```

When available, we can use cell annotation to annotate each metacell to the most abundant cell category (*e.g.* cell type) composing the metacell. 
This also allows us to compute metacell purity. If the annotation considered is the cell type, the **purity** of a metacell is the proportion of the most abundant cell type within the metacell [ref SuperCell]
```{python}
mc_purity = mc_QC.purity(ad, annotation_label, MC_label = 'membership')
mc_purity.head()
# add purity to metadata
mc_ad.obs['purity'] = list(mc_purity[annotation_label + "_purity"])
```

The **compactness** of a metacell is the variance of the components within the metacell [ref SEACells]
```{python}
compactness = mc_QC.compactness(ad, 'X_pca', MC_label = 'membership', DO_DC = False, name = 'Compactness_PCA', n_comp=10)['Compactness_PCA']
# add compactness to metadata
mc_ad.obs['Compactness_PCA'] = list(compactness)
```


The **separation** of a metacell is the distance to the closest metacell [ref SEACells]
```{python}
separation = mc_QC.separation(ad, 'X_pca', MC_label = 'membership', DO_DC = False, name = 'Separation_PCA', n_comp=10)['Separation_PCA']
# add separation to metadata
mc_ad.obs['Separation_PCA'] = list(separation)
```


<!-- The **inner normalized variance (INV)** of a metacell is the mean-normalized variance of gene expression within the metacell [ref MC-2] -->
<!-- ```{python, warning = FALSE, message = FALSE, result = FALSE, eval = FALSE} -->
<!-- mc_INV = mc_QC.mc_inner_normalized_var(ad, MC_label = 'membership') -->

<!-- mc_INV_val = mc_INV.quantile(0.95, axis=1, numeric_only=True) -->
<!-- mc_INV_val = pd.DataFrame(mc_INV_val.transpose()).set_axis(['INV'], axis=1, inplace=False) -->
<!-- # add INV to metadata -->
<!-- mc_ad.obs['INV'] = list(mc_INV_val["INV"]) -->
<!-- ``` -->

```{python, warning = FALSE, message=FALSE, fig.dim = c(15, 15)}
ad.uns['mc_obs'] = mc_ad.obs
mc_QC.mc_visualize_continuous(ad, key='X_umap', group_by_name='membership', 
             colour_sc_name='louvain',  colour_mc_name='purity', colour_metacells=True,
             legend_sc=None, legend_mc='auto', metacell_size=30)
             
mc_QC.mc_visualize_continuous(ad, key='X_umap', group_by_name='membership', 
             colour_sc_name='louvain',  colour_mc_name='Compactness_PCA', colour_metacells=True, 
             legend_sc=None, legend_mc='auto', metacell_size=30)   
             
mc_QC.mc_visualize_continuous(ad, key='X_umap', group_by_name='membership', 
             colour_sc_name='louvain',  colour_mc_name='Separation_PCA', colour_metacells=True, 
             legend_sc=None, legend_mc='auto', metacell_size=30)   

```
